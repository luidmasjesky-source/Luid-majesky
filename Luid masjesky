-- Simple Black ServerHop GUI | Draggable + Minimize + Save Config + Rejoin
-- Tombol: Hop ke Server Ramai + Hop ke Small Server
-- Auto Hop menggunakan mode "Server Ramai"
-- Synapse X / Script-Ware / Krnl / Fluxus / Solara compatible

local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local lp = Players.LocalPlayer

-- Config
local CONFIG_FILE = "SimpleHop_Config.json"
local config = { autoHopEnabled = false }
if isfile and isfile(CONFIG_FILE) then
    local success, loaded = pcall(function()
        return HttpService:JSONDecode(readfile(CONFIG_FILE))
    end)
    if success and type(loaded) == "table" then
        config = loaded
    end
end

-- ScreenGui
local sg = Instance.new("ScreenGui")
sg.Name = "ServerHopGUI"
sg.ResetOnSpawn = false
sg.Parent = game:GetService("CoreGui")

-- Main Frame (ditinggikan biar muat 4 tombol)
local main = Instance.new("Frame")
main.Size = UDim2.new(0, 190, 0, 230)
main.Position = UDim2.new(0.5, -95, 0.5, -115)
main.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
main.BorderSizePixel = 0
main.ClipsDescendants = true
main.Parent = sg

-- Title
local title = Instance.new("Frame")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
title.BorderSizePixel = 0
title.Parent = main

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -50, 1, 0)
titleLabel.Position = UDim2.new(0, 10, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Server Hop"
titleLabel.TextColor3 = Color3.fromRGB(210, 210, 210)
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 17
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = title

-- Minimize
local minBtn = Instance.new("TextButton")
minBtn.Size = UDim2.new(0, 30, 0, 30)
minBtn.Position = UDim2.new(1, -35, 0, 0)
minBtn.BackgroundColor3 = Color3.fromRGB(38, 38, 38)
minBtn.BorderSizePixel = 0
minBtn.Text = "−"
minBtn.TextColor3 = Color3.fromRGB(170, 170, 170)
minBtn.Font = Enum.Font.SourceSansBold
minBtn.TextSize = 20
minBtn.Parent = title

-- Content
local content = Instance.new("Frame")
content.Size = UDim2.new(1, 0, 1, -36)
content.Position = UDim2.new(0, 0, 0, 36)
content.BackgroundTransparency = 1
content.Parent = main

-- Tombol Hop ke Server Ramai
local btnRamai = Instance.new("TextButton")
btnRamai.Size = UDim2.new(0.88, 0, 0, 38)
btnRamai.Position = UDim2.new(0.06, 0, 0.04, 0)
btnRamai.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
btnRamai.BorderSizePixel = 0
btnRamai.Text = "Hop ke Server Ramai"
btnRamai.TextColor3 = Color3.fromRGB(230, 230, 240)
btnRamai.Font = Enum.Font.SourceSansSemibold
btnRamai.TextSize = 16
btnRamai.Parent = content

-- Tombol Hop ke Small Server
local btnSmall = Instance.new("TextButton")
btnSmall.Size = UDim2.new(0.88, 0, 0, 38)
btnSmall.Position = UDim2.new(0.06, 0, 0.26, 0)
btnSmall.BackgroundColor3 = Color3.fromRGB(40, 70, 40)
btnSmall.BorderSizePixel = 0
btnSmall.Text = "Hop ke Small Server"
btnSmall.TextColor3 = Color3.fromRGB(230, 230, 240)
btnSmall.Font = Enum.Font.SourceSansSemibold
btnSmall.TextSize = 16
btnSmall.Parent = content

-- Tombol Rejoin
local btnRejoin = Instance.new("TextButton")
btnRejoin.Size = UDim2.new(0.88, 0, 0, 38)
btnRejoin.Position = UDim2.new(0.06, 0, 0.48, 0)
btnRejoin.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
btnRejoin.BorderSizePixel = 0
btnRejoin.Text = "Rejoin"
btnRejoin.TextColor3 = Color3.fromRGB(220, 220, 220)
btnRejoin.Font = Enum.Font.SourceSans
btnRejoin.TextSize = 17
btnRejoin.Parent = content

-- Tombol Auto Hop
local btnAuto = Instance.new("TextButton")
btnAuto.Size = UDim2.new(0.88, 0, 0, 38)
btnAuto.Position = UDim2.new(0.06, 0, 0.70, 0)
btnAuto.BackgroundColor3 = config.autoHopEnabled and Color3.fromRGB(70, 140, 70) or Color3.fromRGB(50, 50, 50)
btnAuto.BorderSizePixel = 0
btnAuto.Text = "Auto Hop (" .. (config.autoHopEnabled and "ON" or "OFF") .. ")"
btnAuto.TextColor3 = Color3.fromRGB(230, 230, 230)
btnAuto.Font = Enum.Font.SourceSansSemibold
btnAuto.TextSize = 17
btnAuto.Parent = content

-- Corner radius
local function addCorner(parent)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, 7)
    c.Parent = parent
end
addCorner(main) addCorner(title) addCorner(btnRamai) addCorner(btnSmall) addCorner(btnRejoin) addCorner(btnAuto)

-- Setting Small Server (ubah angka ini sesuai kebutuhan)
local SMALL_SERVER_MAX = 10   -- ≤ 10 player = small server

-- Fungsi ambil list server
local function fetchServers()
    local success, res = pcall(function()
        return HttpService:JSONDecode(game:HttpGetAsync("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
    end)
    if not success or not res or not res.data then
        warn("Gagal fetch server list")
        return nil
    end
    return res.data
end

-- Hop ke Server RAMAI (player terbanyak, tapi masih ada slot)
local function hopToRamai()
    local servers = fetchServers()
    if not servers then return end

    local candidates = {}
    for _, s in ipairs(servers) do
        if s.playing < s.maxPlayers and s.playing > 5 and s.id ~= game.JobId then  -- minimal 6 player biar benar-benar ramai
            table.insert(candidates, s)
        end
    end

    if #candidates == 0 then
        warn("Tidak ada server ramai yang tersedia")
        return
    end

    table.sort(candidates, function(a, b) return a.playing > b.playing end)  -- descending = paling ramai dulu
    local target = candidates[1]
    print("Hop ke RAMAI → " .. target.playing .. "/" .. target.maxPlayers)
    pcall(TeleportService.TeleportToPlaceInstance, TeleportService, game.PlaceId, target.id, lp)
end

-- Hop ke Small Server (kecil, ≤ SMALL_SERVER_MAX)
local function hopToSmall()
    local servers = fetchServers()
    if not servers then return end

    local candidates = {}
    for _, s in ipairs(servers) do
        if s.playing > 0 and s.playing <= SMALL_SERVER_MAX and s.playing < s.maxPlayers and s.id ~= game.JobId then
            table.insert(candidates, s)
        end
    end

    if #candidates == 0 then
        warn("Tidak ada small server (≤" .. SMALL_SERVER_MAX .. " player)")
        return
    end

    table.sort(candidates, function(a, b) return a.playing < b.playing end)
    local target = candidates[1]
    print("Hop ke SMALL → " .. target.playing .. "/" .. target.maxPlayers)
    pcall(TeleportService.TeleportToPlaceInstance, TeleportService, game.PlaceId, target.id, lp)
end

-- Rejoin
local function rejoin()
    if game.JobId and game.JobId ~= "" then
        pcall(TeleportService.TeleportToPlaceInstance, TeleportService, game.PlaceId, game.JobId, lp)
    else
        warn("Tidak bisa rejoin - JobId kosong")
    end
end

-- Auto Hop Logic (pakai mode RAMAI)
local autoRunning = false
local autoConnection

local function setAutoHop(enabled)
    autoRunning = enabled
    btnAuto.Text = "Auto Hop (" .. (enabled and "ON" or "OFF") .. ")"
    btnAuto.BackgroundColor3 = enabled and Color3.fromRGB(70, 140, 70) or Color3.fromRGB(50, 50, 50)

    if writefile then
        pcall(function()
            writefile(CONFIG_FILE, HttpService:JSONEncode({ autoHopEnabled = enabled }))
        end)
    end

    if enabled then
        if autoConnection then autoConnection:Disconnect() end
        autoConnection = RunService.Heartbeat:Connect(function()
            if not autoRunning then return end
            hopToRamai()   -- AUTO menggunakan filter SERVER RAMAI
            task.wait(7 + math.random(2, 6))  -- delay 7-13 detik (lebih aman)
        end)
    else
        if autoConnection then
            autoConnection:Disconnect()
            autoConnection = nil
        end
    end
end

-- Events
btnRamai.MouseButton1Click:Connect(hopToRamai)
btnSmall.MouseButton1Click:Connect(hopToSmall)
btnRejoin.MouseButton1Click:Connect(rejoin)
btnAuto.MouseButton1Click:Connect(function()
    setAutoHop(not autoRunning)
end)

-- Minimize logic
local isMinimized = false
minBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    if isMinimized then
        main.Size = UDim2.new(0, 190, 0, 30)
        content.Visible = false
        minBtn.Text = "+"
    else
        main.Size = UDim2.new(0, 190, 0, 230)
        content.Visible = true
        minBtn.Text = "−"
    end
end)

-- Draggable
local dragging, dragInput, dragStart, startPos
title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = main.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Load auto dari config
if config.autoHopEnabled then
    task.spawn(function()
        task.wait(2.8)
        setAutoHop(true)
    end)
end

print("ServerHop loaded → Ramai / Small / Auto (mode Ramai)")
